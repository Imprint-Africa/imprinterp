<!-- Title -->
<section id="title_section">
  <h4>Sales</h4>
  <p>Creates and lists Incoming Projects </p>
</section>






<!-- Body Section -->
<section class="body_section">




<!-- Adding new client Form -->

<div bsModal #addNewClientModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog addNewClientModal" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">New Clients To <span>{{ProjectStatusToNewClient}}</span></h4>
        <button type="button" class="btn close" (click)="addNewClientModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
                    
              <form id="myNewClientForm" #myNewClientForm='ngForm' [formGroup]="newClientForm" class="form">

                <!-- Client Name -->
                <div class="form-group">
                    <div class="input-group input-group-sm mb-3">

                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-sm">Client Name</span>
                        </div>

                        <input #clientInput type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm"
                        formControlName="clientName" [class.is-invalid]="formNewClient.clientName.invalid && formNewClient.clientName.touched" required>

                  </div>

                </div>


                <!-- Projects Type -->
                <div class="form-group">
                    <div class="input-group input-group-sm mb-3">

                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-sm">Project Type</span>
                        </div>


                        <select type="" aria-label="Small" aria-describedby="inputGroup-sizing-sm"
                        formControlName="projectName" class="form-control" [class.is-invalid]="formNewClient.projectName.invalid && formNewClient.projectName.touched" required>
                            <option value="" disabled selected hidden >Choose Project</option>
                            <option *ngFor="let Project of Projects" value='{{Project.serviceName}}'>{{Project.serviceName}}</option>
                            
                        </select> 

                  </div>
                </div>


            </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" (click)="addNewClientModal.hide()">Cancel</button>
        <button type="button" [disabled]="!newClientForm.valid"class="btn btn-confirm" (click)="submitNewClientForm(); addNewClientModal.hide()">Save</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->





<div bsModal #addNewStageModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog addNewStageModal" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">New Stage </h4>
        <button type="button" class="btn close" (click)="addNewStageModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
                    
              <form id="myNewStageForm" #myNewStageForm='ngForm' [formGroup]="newStageForm" class="form">
                <div class="form-group">
                  <div class="input-group input-group-sm mb-3">

                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-sm">New Stage</span>
                        </div>

                        <input #newStageInput type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm"
                        formControlName="name" [class.is-invalid]="formNewStage.name.invalid && formNewStage.name.touched">

                  </div>
                </div>
            </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" (click)="addNewStageModal.hide()">Cancel</button>
        <button type="button" [disabled]="!myNewStageForm.valid"class="btn btn-confirm" (click)="submitNewStageForm(); addNewStageModal.hide()">Save</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->








<!-- List Section -->
<section id="list_section" class="d-flex" *ngIf="UserSalesStages">




  <!-- Sales Category Card-->
  <article *ngFor='let UserSalesStage of UserSalesStages' [id]="UserSalesStage._id"
   (dragover)="allowDrop($event)" (drop)="drop($event)">
    
    <!-- Head Title -->
    <div id="head" class="clearfix d-flex">
        <div class="info-div" *ngIf="!UserSalesStage._id2">
            <h4 class="float-left">{{UserSalesStage.name}} <span>({{UserSalesStage.totalLeads}})</span></h4>
        </div>

        <form class="form" *ngIf="UserSalesStage._id4">
            <div class="form-group" [formGroup]="changeStageNameForm">
                <input type="text" class="form-control"
                formControlName="name" [class.is-invalid]="formChangeStageName.name.invalid && formChangeStageName.name.touched">
            </div>
        </form>

        <button class="btn btn-sm ml-auto mr-2" *ngIf="!UserSalesStage._id2" (click)="stageToBeEdited(UserSalesStage._id); UserSalesStage._id2 = true; UserSalesStage._id4 = true">
          <fa name="pencil"></fa>
        </button>

        <button class="btn btn-sm ml-auto mr-2" *ngIf="UserSalesStage._id4" (click)="submitEditedStage(); UserSalesStage._id2 = false; UserSalesStage._id4 = false">
          <fa name="check"></fa>
        </button>

        <button class="btn btn-sm ml-auto mr-2" *ngIf="UserSalesStage._id4" (click)="UserSalesStage._id2 = false; UserSalesStage._id4 = false">
          <fa name="cross"></fa>
        </button>

        <button class="btn btn-sm ml-auto" *ngIf="UserSalesStage._id4">
          <fa name="trash"></fa>
        </button>
        
        <button class="btn btn-sm ml-auto" *ngIf="!UserSalesStage._id2" (click)="addNewStageModal.show();">
            <fa name="plus"></fa>
        </button>
        
    </div>
    
    <div id="totals" class="clearfix text-center">
      <h4 class="">$:<span>{{UserSalesStage.totalRevenue}}</span></h4>
    </div>

    <div id="add_deal_div" class="clearfix text-center">
      <button class="btn btn-sm" (click)="addNewClientModal.show(); setClickedStage(UserSalesStage.name)"><fa name="plus"></fa></button>
    </div>


  







   <div class="card-group" [id]="UserSalesStage._id" (dragenter)="highlightcategory($event)"
   [ngClass]="salesCatHoveredOnDrag === UserSalesStage._id ? 'card-group hovered' : 'card-group'" >

    <!-- Cards -->

        <div draggable="true" *ngFor="let Opportunity of Opportunitys" [id]="Opportunity._id" (click)="toSalesEdit(Opportunity._id)" 
        (drop)="drop($event)" (dragover)="allowDrop($event)" (dragstart)="drag($event)" (dragenter)="dragenter($event)" (dragleave)="dragleave($event)"
        [ngClass]="cardHoveredOnDrag === Opportunity._id && cardBeingDraged !=  Opportunity._id ? 'card hovered-on-drag' : cardBeingDraged ===  Opportunity._id ? 'card beingDragged' : 'card'"
          [hidden]="Opportunity.projectStatus != UserSalesStage.name">

          <div class="card-body">

            <div class="card-info-div">
              <h4  class="clientN">{{ Opportunity.clientName}}</h4>
              <h4  class="projectN">{{ Opportunity.projectName}}</h4>
              <h4  class="cost">$: {{ Opportunity.cost}}</h4>

              <div  class="rateWarp clearfix">
                  <fa class="rate1" name="star" [ngClass]="Opportunity.priority >= '1' ? 'rateColor' : ''"></fa>

                  <fa class="rate2" name="star" [ngClass]="Opportunity.priority >= '2' ? 'rateColor' : ''"></fa>
                  <fa   class="rate3" name="star" [ngClass]="Opportunity.priority >= '3' ? 'rateColor' : ''"></fa>
              </div>
            </div><!-- .card-info-div -->

            <div class="card-icon-div">
              <button class="btn btn-sm"><fa name="envelope"></fa></button>
              <button class="btn btn-sm"><fa name="phone"></fa></button>

            </div><!-- .card-icon-div -->

          </div><!-- .card-body-->

              <div class="card-footer card-icon-div d-flex">
                <h4 class="mr-auto">Activities <span>3</span></h4>
                <h4 class="ml-auto schedule">Schedule</h4>
              </div>
              


        </div>

    </div>

</article>


</section>



<!-- End of Body Section -->
</section>